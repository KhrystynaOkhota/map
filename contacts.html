<!DOCTYPE html>
<html lang="uk" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>

    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1"/>
    <meta name="format-detection" content="telephone=no"/>

    <title>Bahar</title>
    <meta name="description" content=""/>
    <link rel="stylesheet" href="assets/css/swiper-bundle.min.css"/>


    <link rel="stylesheet" href="assets/css/app.css"/>


</head>
<body>
<style>
    #map {
        height: 600px;
        width: 100%;
    }
</style>
<div class="preloader">

</div>


<header class="header js-header transparent">
    <div class=" container">
        <div class="header__inner d-flex align-middle align-justify">


            <div class="d-flex align-right align-middle">

                <div class="burger__wrap h-burger d-flex align-middle align-left">
                    <div class="burger">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                    <div class="burger__title d-none d-md-block text-light">Меню</div>
                </div>
                <a href="index.html" class="logo__wrap">
                    <img src="assets/img/logo-header.svg" alt="Bahar" class="logo">
                </a>
                <a href="" class=" btn btn-transparent d-none d-md-inline-block">Выбрать квартиру</a>
            </div>

            <div class="d-flex align-right align-middle">
                <a href="tel:000000000000" target="_blank" class="phone text-s text-regular">+0 000 000 00
                    00</a>
                <div class="lang__wrap --relative">
                    <div class="lang__current d-flex align-middle">
                        <a href="/ua/">Ua</a> <i class="icon-arrow-bottom"></i> <!--поточна мова-->
                    </div>

                    <ul class="lang">
                        <li class="lang-item"><a href="ua">Ua</a>
                        </li>
                        <li class="lang-item "><a href="eng">ENG</a>
                        </li>
                    </ul>
                </div>

            </div>


            <!-- <div class="h-menu">-->
            <div class="h-menu">

                <ul class="menu">
                    <li class="menu-item ">
                        <a href="about.html">О проекте</a>
                    </li>
                    <li class="menu-item ">
                        <a href="apartment.html">Квартиры</a>
                    </li>
                    <li class="menu-item ">
                        <a href="contacts.html">Контакты</a>
                    </li>

                    <li class="menu-item">
                        <a href="infrastructure.html">Инфраструктура</a>
                    </li>
                    <li class="menu-item">
                        <a href="developer.html">Застройщик</a>
                    </li>
                    <li class="menu-item">
                        <a href="location.html">Расположение</a>
                    </li>
                    <li class="menu-item">
                        <a href="sales-department.html">Отдел продаж</a>
                    </li>
                </ul>

                <ul class="social__list">
                    <li class="social__item align-middle">
                        <a href="" class="social__link">
                            <i class="icon-pinterest"></i>
                        </a>
                    </li>
                    <li class="social__item align-middle">
                        <a href="" class="social__link">
                            <i class="icon-linkedin"></i>
                        </a>
                    </li>
                    <li class="social__item align-middle">
                        <a href="" class="social__link">
                            <i class="icon-tik-tok"></i>
                        </a>
                    </li>
                    <li class="social__item align-middle">
                        <a href="" class="social__link">
                            <i class="icon-youtube"></i>
                        </a>
                    </li>
                    <li class="social__item align-middle">
                        <a href="" class="social__link">
                            <i class="icon-facebook"></i>
                        </a>
                    </li>
                    <li class="social__item align-middle">
                        <a href="" class="social__link">
                            <i class="icon-instagram"></i>
                        </a>
                    </li>
                </ul>


            </div>

            <!-- </div>-->

        </div>
    </div>
</header>

<main class="main">

    <section class="banner">
        <div class="banner__bg overlay">
            <img class="bg" src="assets/img/banner-1.png" alt="image">
        </div>
        <div class="container">
            <div class="banner__content  text-center">

                <div class="title h1 heading heading-font">
                    Contacts
                </div>
                <div class="btn-scroll scroll-to-content banner__scroll-down d-flex align-center align-middle">
                    <i class="icon-ar-bottom"></i>
                </div>
            </div>
        </div>


        <ul class="social__list d-none d-md-block">
            <li class="social__item align-middle">
                <a href="" class="social__link">
                    <i class="icon-pinterest"></i>
                </a>
            </li>
            <li class="social__item align-middle">
                <a href="" class="social__link">
                    <i class="icon-linkedin"></i>
                </a>
            </li>
            <li class="social__item align-middle">
                <a href="" class="social__link">
                    <i class="icon-tik-tok"></i>
                </a>
            </li>
            <li class="social__item align-middle">
                <a href="" class="social__link">
                    <i class="icon-youtube"></i>
                </a>
            </li>
            <li class="social__item align-middle">
                <a href="" class="social__link">
                    <i class="icon-facebook"></i>
                </a>
            </li>
            <li class="social__item align-middle">
                <a href="" class="social__link">
                    <i class="icon-instagram"></i>
                </a>
            </li>
        </ul>
    </section>

    <section>
        <div class="container">
            <div class="section-title section-title_center text-center title">

            </div>
            <div class="row justify-content-center">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-xs-12">

                    <div class="delivery-map-wrap">
                        <div class="map-block map" id="map" data-lat="49.834338" data-lng="23.984174" data-zoom="12"
                             data-map-marker="https://kebabtsia.com/wp-content/uploads/2024/03/marker.svg"
                             data-map-link="./assets/js/map_zones-30.json">


                        </div>
                        <div class="delivery-map-inputs">
                            <div class="input-field">
                                <div class="input-field__input-wrap">
                                    <select class="city_select" data-placeholder="Оберіть місто" name="select_city"
                                            data-options='{"showSearch":false, "allowDeselect":false}'>
                                        <option data-placeholder="true"></option>
                                        <option selected>Львів</option>
                                    </select>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>


</main>

<footer class="footer">
    <div class="container">
        <div class="row m-row">
            <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 column">
                <a href="index.html" class="logo__link">
                    <img src="assets/img/logo.svg" alt="Klan" class="logo">
                </a>
                <div class="copyright">
                    <span class="d-none d-md-block">© Bahar Residence | 2023 </span>
                    <a href="">Политика конфиденциальности</a>
                </div>
                <div class="develop d-none align-middle align-right">
                    <div class="develop__text">Розробка</div>
                    <a href="" class="d-inline-flex align-items-center develop__link">
                        WEBTUNE
                    </a>
                </div>
            </div>
            <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12 footer__item column">
                <div class="footer__title text-semibold text-uppercase">Карта сайта</div>
                <ul class="menu">
                    <li class="menu-item  current-menu-item">
                        <a href="">О проекте</a>
                    </li>
                    <li class="menu-item">
                        <a href=""> Квартиры</a>
                    </li>
                    <li class="menu-item">
                        <a href="">Контакты</a>
                    </li>
                    <li class="menu-item">
                        <a href="">Инфраструктура</a>
                    </li>
                    <li class="menu-item  current-menu-item">
                        <a href="">Застройщик</a>
                    </li>
                    <li class="menu-item">
                        <a href=""> Расположение</a>
                    </li>
                    <li class="menu-item">
                        <a href=""> Отдел продаж</a>
                    </li>
                </ul>
            </div>
            <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12  footer__item --relative column">
                <div class="footer__title text-semibold text-uppercase">контакти</div>

                <ul class="contact__list">
                    <li class="contact__item">
                        <a href="tel:+00000000000" class="contact__text d-flex align-middle"><i class="icon-phone"></i>
                            +0 000 000 00 00</a>
                    </li>
                    <li class="contact__item">
                        <a href="" class="contact__text d-flex align-middle"><i class="icon-location"></i> 53 Əcəmi
                            Naxçıvani, Bakı 1010</a>

                    </li>
                    <li class="contact__item">
                        <a href="" class="contact__text d-flex align-middle"><i class="icon-email"></i>
                            baharresidence@gmail.com</a>

                    </li>
                </ul>

                <ul class="social__list d-flex align-middle">
                    <li class="social__item align-middle">
                        <a href="" class="social__link">
                            <i class="icon-pinterest"></i>
                        </a>
                    </li>
                    <li class="social__item align-middle">
                        <a href="" class="social__link">
                            <i class="icon-linkedin"></i>
                        </a>
                    </li>
                    <li class="social__item align-middle">
                        <a href="" class="social__link">
                            <i class="icon-tik-tok"></i>
                        </a>
                    </li>
                    <li class="social__item align-middle">
                        <a href="" class="social__link">
                            <i class="icon-youtube"></i>
                        </a>
                    </li>
                    <li class="social__item align-middle">
                        <a href="" class="social__link">
                            <i class="icon-facebook"></i>
                        </a>
                    </li>
                    <li class="social__item align-middle">
                        <a href="" class="social__link">
                            <i class="icon-instagram"></i>
                        </a>
                    </li>
                </ul>

                <div class="footer__bottom d-block d-md-none">


                    <div class="copyright text-center">
                        <span class="text-uppercase">© Bahar Residence | 2023 </span>
                    </div>
                    <div class="develop d-flex align-middle align-right">
                        <div class="develop__text">Розробка</div>
                        <a href="" class="d-inline-flex text-uppercase align-items-center develop__link">
                            WEBTUNE
                        </a>
                    </div>

                </div>
            </div>
        </div>
    </div>
</footer>

<script src="./assets/js/jquery-3.7.0.min.js"></script>




<script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB4mHyxxXpYptpuoSF9C2EYfJJsLTmLSkM"

></script>

<script src="./assets/js/infobox.js"></script>
<script>

    $(function ($) {
        let activeLink = window.location.pathname;
        var maps = [],
            ibSize = 220,
            mapStyles = [
                {
                    featureType: "all",
                    elementType: "labels.text.fill",
                    stylers: [
                        {
                            saturation: 36,
                        },
                        {
                            color: "#000000",
                        },
                        {
                            lightness: 40,
                        },
                    ],
                },
                {
                    featureType: "all",
                    elementType: "labels.text.stroke",
                    stylers: [
                        {
                            visibility: "on",
                        },
                        {
                            color: "#000000",
                        },
                        {
                            lightness: 16,
                        },
                    ],
                },
                {
                    featureType: "all",
                    elementType: "labels.icon",
                    stylers: [
                        {
                            visibility: "off",
                        },
                    ],
                },
                {
                    featureType: "administrative",
                    elementType: "geometry.fill",
                    stylers: [
                        {
                            color: "#000000",
                        },
                        {
                            lightness: 20,
                        },
                    ],
                },
                {
                    featureType: "administrative",
                    elementType: "geometry.stroke",
                    stylers: [
                        {
                            color: "#000000",
                        },
                        {
                            lightness: 17,
                        },
                        {
                            weight: 1.2,
                        },
                    ],
                },
                {
                    featureType: "administrative",
                    elementType: "labels",
                    stylers: [
                        {
                            visibility: "off",
                        },
                    ],
                },
                {
                    featureType: "administrative.country",
                    elementType: "all",
                    stylers: [
                        {
                            visibility: "simplified",
                        },
                    ],
                },
                {
                    featureType: "administrative.country",
                    elementType: "geometry",
                    stylers: [
                        {
                            visibility: "simplified",
                        },
                    ],
                },
                {
                    featureType: "administrative.country",
                    elementType: "labels.text",
                    stylers: [
                        {
                            visibility: "simplified",
                        },
                    ],
                },
                {
                    featureType: "administrative.province",
                    elementType: "all",
                    stylers: [
                        {
                            visibility: "off",
                        },
                    ],
                },
                {
                    featureType: "administrative.locality",
                    elementType: "all",
                    stylers: [
                        {
                            visibility: "simplified",
                        },
                        {
                            saturation: "-100",
                        },
                        {
                            lightness: "30",
                        },
                    ],
                },
                {
                    featureType: "administrative.neighborhood",
                    elementType: "all",
                    stylers: [
                        {
                            visibility: "off",
                        },
                    ],
                },
                {
                    featureType: "administrative.land_parcel",
                    elementType: "all",
                    stylers: [
                        {
                            visibility: "off",
                        },
                    ],
                },
                {
                    featureType: "landscape",
                    elementType: "all",
                    stylers: [
                        {
                            visibility: "simplified",
                        },
                        {
                            gamma: "0.00",
                        },
                        {
                            lightness: "74",
                        },
                    ],
                },
                {
                    featureType: "landscape",
                    elementType: "geometry",
                    stylers: [
                        {
                            color: "#000000",
                        },
                        {
                            lightness: 20,
                        },
                    ],
                },
                {
                    featureType: "landscape.man_made",
                    elementType: "all",
                    stylers: [
                        {
                            lightness: "3",
                        },
                    ],
                },
                {
                    featureType: "poi",
                    elementType: "all",
                    stylers: [
                        {
                            visibility: "off",
                        },
                    ],
                },
                {
                    featureType: "poi",
                    elementType: "geometry",
                    stylers: [
                        {
                            color: "#000000",
                        },
                        {
                            lightness: 21,
                        },
                    ],
                },
                {
                    featureType: "road",
                    elementType: "geometry",
                    stylers: [
                        {
                            visibility: "simplified",
                        },
                    ],
                },
                {
                    featureType: "road.highway",
                    elementType: "geometry.fill",
                    stylers: [
                        {
                            color: "#000000",
                        },
                        {
                            lightness: 17,
                        },
                    ],
                },
                {
                    featureType: "road.highway",
                    elementType: "geometry.stroke",
                    stylers: [
                        {
                            color: "#000000",
                        },
                        {
                            lightness: 29,
                        },
                        {
                            weight: 0.2,
                        },
                    ],
                },
                {
                    featureType: "road.arterial",
                    elementType: "geometry",
                    stylers: [
                        {
                            color: "#000000",
                        },
                        {
                            lightness: 18,
                        },
                    ],
                },
                {
                    featureType: "road.local",
                    elementType: "geometry",
                    stylers: [
                        {
                            color: "#000000",
                        },
                        {
                            lightness: 16,
                        },
                    ],
                },
                {
                    featureType: "transit",
                    elementType: "geometry",
                    stylers: [
                        {
                            color: "#000000",
                        },
                        {
                            lightness: 19,
                        },
                    ],
                },
                {
                    featureType: "water",
                    elementType: "geometry",
                    stylers: [
                        {
                            color: "#000000",
                        },
                        {
                            lightness: 17,
                        },
                    ],
                },
            ],
            ibOptions = {
                alignBottom: true,
                content: "text",
                closeBoxURL: "http://moonart.net.ua/olehm/tobbi/img/icons/close.svg",
                pixelOffset:
                    window.innerWidth > 767
                        ? new google.maps.Size(-245, -40)
                        : new google.maps.Size(-110, -45),
                boxStyle: {
                    width: ibSize + "px",
                },
            },
             ib = new InfoBox(ibOptions),
            mapDefaulZoom;

        function Map(id, mapOptions) {
            this.map = new google.maps.Map(document.getElementById(id), mapOptions);
            this.markers = [];
            this.infowindows = [];
            this.clusters = null;
        }

        function addMarker(mapId, location, index, infobox, image, activeImage) {
            let markerInst = new google.maps.Marker({
                position: location,
                map: maps[mapId].map,
                icon: {
                    url: image,
                    scaledSize: new google.maps.Size(40, 40),
                },
                mainImage: image,
                activeIcon: activeImage,
                active: false,
            });

            if (infobox) {
                let phones = "";

                if (infobox.phones.length) {
                    phones += "<div>";
                    infobox.phones.forEach((phone) => {
                        phones += `<a class="infobox-contact btn-link btn-link_inline" href="${phone.link}" >${phone.number}</a>`;
                    });
                    phones += "</div>";
                }

                let content = `<div class="info-box-wrapper">
        <img src="` + window.location.origin + `/wp-content/themes/kebabtsia/img/logo-text.svg" alt="" loading="lazy">
        ${infobox.address ? `<div>${infobox.address}</div> ` : ""}
        ${
                    infobox.workingHours.length
                        ? `<div>${infobox.workingHours.join("<br>")}</div>`
                        : ""
                    }
        ${phones}

      </div>`;
                google.maps.event.addListener(markerInst, "click", function () {
                    ib.setContent(content);
                    ib.setPosition(location);

                    ib.open(maps[mapId].map);
                    if (window.innerWidth < 768) maps[mapId].map.panTo(this.getPosition());
                    setTimeout(() => {
                        if (window.innerWidth < 768) {
                            maps[mapId].map.panBy(0, -100);
                        } else {
                            maps[mapId].map.panBy(0, 0);
                        }
                    }, 5);

                    // this.setIcon(this.activeIcon);
                    this.active = false;
                    setTimeout(() => {
                        //_functions.initSwiper($(".search-map .swiper-container"));
                    }, 200);
                });
            }
            return markerInst;
        }

        function constructPoligons(locationsData) {
            const redZones = locationsData.redZones;
            const yellowZones = locationsData.yellowZones;
            const greenZones = locationsData.greenZones;
            const polygons = {};

            if (redZones) {
                polygons.redZonesPolygons = [];
                redZones.zoneLocations.forEach(function (location) {
                    const polygon = new google.maps.Polygon({
                        paths: location.path,
                        strokeColor: redZones.strokeColor,
                        strokeOpacity: redZones.strokeOpacity,
                        strokeWeight: redZones.strokeWeight,
                        fillColor: redZones.fillColor,
                        fillOpacity: redZones.fillOpacity,
                    });
                    polygons.redZonesPolygons.push(polygon);
                });
            }

            if (yellowZones) {
                polygons.yellowZonesPolygons = [];
                yellowZones.zoneLocations.forEach(function (location) {
                    const polygon = new google.maps.Polygon({
                        paths: location.path,
                        strokeColor: yellowZones.strokeColor,
                        strokeOpacity: yellowZones.strokeOpacity,
                        strokeWeight: yellowZones.strokeWeight,
                        fillColor: yellowZones.fillColor,
                        fillOpacity: yellowZones.fillOpacity,
                    });
                    polygons.yellowZonesPolygons.push(polygon);
                });
            }

            if (greenZones) {
                polygons.greenZonesPolygons = [];
                greenZones.zoneLocations.forEach(function (location) {
                    const polygon = new google.maps.Polygon({
                        paths: location.path,
                        strokeColor: greenZones.strokeColor,
                        strokeOpacity: greenZones.strokeOpacity,
                        strokeWeight: greenZones.strokeWeight,
                        fillColor: greenZones.fillColor,
                        fillOpacity: greenZones.fillOpacity,
                    });
                    polygons.greenZonesPolygons.push(polygon);
                });
            }

            //console.log('polygons: ', polygons);
            return polygons;
        }

        function GMap($mapInst) {

            console.log($mapInst.attr("data-map-link"));
            let markersArr = [];
            var lat = $mapInst.attr("data-lat"),
                lng = $mapInst.attr("data-lng"),
                setZoom =
                    window.innerWidth < 767
                        ? parseInt($mapInst.attr("data-xs-zoom"))
                        : parseInt($mapInst.attr("data-zoom")),
                mapId = $mapInst.attr("id"),
                clusterImg =
                    $mapInst.attr("data-cluster-img") || $mapInst.data("map-marker"),
                zoomControl = typeof $mapInst.data("disable-zoom") == "undefined",
                markerImage = $mapInst.data("map-marker");

            if (window.innerWidth < 767) {
                if (!$mapInst.attr("data-xs-zoom") == "") {
                    mapDefaulZoom = setZoom;
                } else {
                    mapDefaulZoom = 10;
                }
            } else {
                if (!$mapInst.attr("data-zoom") == "") {
                    mapDefaulZoom = setZoom;
                } else {
                    mapDefaulZoom = 12;
                }
            }

            var mapOptions = {
                zoom: mapDefaulZoom,
                disableDefaultUI: true,
                scrollwheel: false,
                zoomControl: zoomControl,
                zoomControlOptions: {
                    style: google.maps.ZoomControlStyle.SMALL,
                    position: google.maps.ControlPosition.RIGHT_BOTTOM,
                },
               // streetViewControl: false,
              //  fullscreenControl: false,
              //  styles: mapStyles,
                minZoom: 2,
            };

            function renderMarkers(data) {
                for (let i = 0; i < data.length; i++) {
                    var markerInst = addMarker(
                        data[i].dataRel,
                        new google.maps.LatLng(data[i].dataLat, data[i].dataLng),
                        i,
                        data[i].infobox,
                        data[i].dataImg,
                        data[i].dataImgActive
                    );
                    markersArr.push(markerInst);
                }

                // const renderer = {
                //   render: ({ count, position }) =>
                //     new google.maps.Marker({
                //       icon: clusterImg,
                //       label: {
                //         text: String(count),
                //         color: "0x090919",
                //         fontSize: "16px",
                //       },
                //       position,
                //       // adjust zIndex to be above other markers
                //       zIndex: Number(google.maps.Marker.MAX_ZINDEX) + count,
                //     }),
                // };
                // maps[mapId].markerClusterer = new markerClusterer.MarkerClusterer({
                //   map: maps[mapId].map,
                //   markers: markersArr,
                //   renderer,
                // });

                markersArr.forEach(function (marker, index) {
                    maps[mapId].bounds.extend(marker.getPosition());
                });

                if (markersArr.length == 1) {
                    maps[mapId].map.setCenter({
                        lat: parseFloat(markersArr[0].position.lat()),
                        lng: parseFloat(markersArr[0].position.lng()),
                    });
                    maps[mapId].map.setZoom(mapDefaulZoom);
                } else {
                    maps[mapId].map.fitBounds(maps[mapId].bounds, {
                        top: 10,
                        left: 80,
                        right: 80,
                        bottom: 10,
                    });
                }
            }

            maps[mapId] = new Map(mapId, mapOptions);
            maps[mapId].bounds = new google.maps.LatLngBounds();
            if (!lat == "" && !lng == "") {
                maps[mapId].map.setCenter({
                    lat: parseFloat(lat),
                    lng: parseFloat(lng),
                });
            }

            console.log($mapInst.data("link"));
            // .length
            if ($mapInst.data("link")) {
                let mapDataLink = $mapInst.data("link");


                $.ajax({
                    url: mapDataLink,
                    type: "get",
                    dataType: "json",
                    error: (data) => console.log(data),
                    success: (data) => {

                        console.log(data);
                        renderMarkers(data);
                    },
                });
            }
            if ($mapInst.nextAll(".map-marker").length) {
                let markersData = [];
                $mapInst.nextAll(".map-marker").each(function () {
                    markersData.push($(this).data("marker-params"));
                });
                renderMarkers(markersData);
            }
            if ($mapInst.attr("data-polygons-url")) {
                $.ajax({
                    url: $mapInst.attr("data-polygons-url"),
                    type: "get",
                    dataType: "json",
                    error: (data) => console.log(data),
                    success: (data) => {
                        console.log(data);
                        const polygons = constructPoligons(data);
                        for (let key in polygons) {
                            polygons[key].forEach(function (polygon) {
                                polygon.setMap(maps[mapId].map);
                            });
                        }
                    },
                });
            }

            ib.addListener("closeclick", function () {
                markersArr.forEach(function (marker) {
                    marker.active = false;
                    // marker.setIcon(marker.mainImage);
                });
            });

            //click on map
            maps[mapId].map.addListener("click", function () {
                ib.close();
                markersArr.forEach(function (marker) {
                    marker.active = false;
                    // marker.setIcon(marker.mainImage);
                });
            });

            this.update = function (data) {
                // clear old markers
                ib.close();
                markersArr.forEach((marker) => marker.setMap(null));
                maps[mapId].markerClusterer.clearMarkers();
                markersArr = [];
                // add new
                renderMarkers(data);
            };

            function filterMarkers(filterVal) {
                const visibleMarkers = [];
                maps[mapId].bounds = new google.maps.LatLngBounds();
                markersArr.map((marker) => {
                    const isVisible = filterVal == marker.filter;
                    marker.setVisible(isVisible);
                    if (isVisible) {
                        visibleMarkers.push(marker);
                        maps[mapId].bounds.extend(marker.getPosition());
                    }
                });
                if (visibleMarkers.length) {
                    maps[mapId].map.fitBounds(maps[mapId].bounds, {
                        top: 80,
                        left: 80,
                        right: 80,
                        bottom: 80,
                    });
                }
            }

            if ($mapInst.closest("section").find(`[data-map-filter]`).length) {
                $mapInst
                    .closest("section")
                    .find(`[data-map-filter]`)
                    .on("click", function () {
                        $(this).addClass("active").siblings().removeClass("active");
                        filterMarkers($(this).attr("data-map-filter"));
                    });
                if ($mapInst.closest("section").find(`.active[data-map-filter]`).length) {
                    setTimeout(() => {
                        filterMarkers(
                            $mapInst
                                .closest("section")
                                .find(`.active[data-map-filter]`)
                                .attr("data-map-filter")
                        );
                    }, 100);
                }
            }

            if (markersArr.length && Boolean($mapInst.attr("data-show-infobox"))) {
                setTimeout(() => {
                    google.maps.event.trigger(markersArr[0], "click");
                }, 500);
            }
            return this;
        }





            $(".map").each(function () {
                GMap($(this));


            });


    });

</script>
<script>
    let GeoLocation = {};

    jQuery(function ($) {
        "use strict";

        let markers = [],
            staticMarkers = [],
            streets = [],
            AllStreets = [],
            map,
            myLatlng,
            marker,
            image,
            noDataBase,
            streetFromAutoComplete,
            checkAutocompleteSelect,
            redZone,
            redZone2,
            redZone3,
            greenZone,
            yellowZone,
            yellowZone2,
            step1 = false,
            step2 = false,
            step3 = false,
            locationsDataLink = $(".map").data("map-link"),
            locationsData,
            polygons;
        let searchBounds = {
            Львів: {
                bounds: [
                    { lat: 49.7656834, lng: 23.8685913 },
                    { lat: 49.906071, lng: 24.166724 },
                ],
            },
            Стрий: {
                bounds: [
                    { lat: 49.23522310602632, lng: 23.790609138851202 },
                    { lat: 49.280709536312585, lng: 23.883477941487836 },
                ],
            },
            Пустомити: {
                bounds: [
                    { lat: 49.6296180, lng: 23.6918813 },
                    { lat: 49.8346631, lng: 24.0619832 },
                ],
            },
            Шептицький: {
                bounds: [
                    /*{ lat: 50.38750257526175, lng: 24.14550172622367 },
                    { lat: 50.4011641377287, lng: 24.17778327172155 },*/
                    { lat: 50.368831, lng: 24.122885 },
                    { lat: 50.409499, lng: 24.252432 },


                ],
            },
            // Пустомити: {
            //     bounds: [
            //         { lat: 49.698383404343616, lng: 23.859555690514245 },
            //         { lat: 49.74747770601727, lng: 23.934679551208283 },
            //     ],
            // },
        };
        let ibOptions = {
                alignBottom: true,
                content: "text",
                pixelOffset: new google.maps.Size(
                    $(window).width() < 575 ? -150 : -163,
                    -40
                ),
                boxStyle: {
                    width: $(window).width() < 575 ? "300px" : "326px",
                },
                closeBoxMargin: "5px 5px 5px 5px",
                closeBoxURL: $("#map").attr("data-ib-close-img"),
            },
            ib = new InfoBox(ibOptions);

        // Create markers
        function addMarker(location) {
            image = {
                url: $("#map").attr("data-map-marker"),
                // scaledSize : new google.maps.Size(43, 57),
            };
            marker = new google.maps.Marker({
                position: location,
                icon: image,
            });

            markers.push(marker);
            marker.setMap(map);
            map.panTo(location);
        }

        function addStaticMarker(location, map, string, image, delivery) {
            const staticMarker = new google.maps.Marker({
                position: location,
                map: map,
                icon: image,
                selfdelivery: delivery,
            });
            const content = '<div class="info-box">' + string + "</div>";
            google.maps.event.addListener(staticMarker, "click", function () {
                ib.setContent(content);
                ib.setPosition(location);
                ib.open(map);
            });

            staticMarkers.push(staticMarker);
        }

        function initLocationsMap() {
            // if($('#save-user-address').length){
            //     console.log('yes');
            //     locationsDataLink = $('#save-user-address').attr("data-map-link");
            // }
            console.log(locationsDataLink);
            $.ajax({
                url: locationsDataLink,
                type: "get",
                dataType: "json",
                error: function (data) {
                    console.log("Error receiving external data file");
                },
                success: function (data) {
                    locationsData = data;
                    //console.log(data);
                    polygons = constructPoligons(locationsData);
                    initialize(polygons, locationsData);
                },
            });
        }

        function constructPoligons(locationsData) {
            const redZones = locationsData.redZones;
            const yellowZones = locationsData.yellowZones;
            const greenZones = locationsData.greenZones;
            const polygons = {};

            if (redZones) {
                polygons.redZonesPolygons = [];
                redZones.zoneLocations.forEach(function (location) {
                    const polygon = new google.maps.Polygon({
                        paths: location.path,
                        strokeColor: redZones.strokeColor,
                        strokeOpacity: redZones.strokeOpacity,
                        strokeWeight: redZones.strokeWeight,
                        fillColor: redZones.fillColor,
                        fillOpacity: redZones.fillOpacity,
                        organizationID: location.organizationID,
                    });
                    polygons.redZonesPolygons.push(polygon);
                });
            }

            if (yellowZones) {
                polygons.yellowZonesPolygons = [];
                yellowZones.zoneLocations.forEach(function (location) {
                    const polygon = new google.maps.Polygon({
                        paths: location.path,
                        strokeColor: yellowZones.strokeColor,
                        strokeOpacity: yellowZones.strokeOpacity,
                        strokeWeight: yellowZones.strokeWeight,
                        fillColor: yellowZones.fillColor,
                        fillOpacity: yellowZones.fillOpacity,
                        organizationID: location.organizationID,
                    });
                    polygons.yellowZonesPolygons.push(polygon);
                });
            }

            if (greenZones) {
                polygons.greenZonesPolygons = [];
                greenZones.zoneLocations.forEach(function (location) {
                    const polygon = new google.maps.Polygon({
                        paths: location.path,
                        strokeColor: greenZones.strokeColor,
                        strokeOpacity: greenZones.strokeOpacity,
                        strokeWeight: greenZones.strokeWeight,
                        fillColor: greenZones.fillColor,
                        fillOpacity: greenZones.fillOpacity,
                        organizationID: location.organizationID,
                    });
                    polygons.greenZonesPolygons.push(polygon);
                });
            }
            return polygons;
        }

        // initLocationsMap();

        // initialize map
        function initialize(polygons, locationsData) {
            let currentCity = '';
            if($('body').hasClass('woocommerce-checkout')){
                currentCity = $('select[name="city"]').val();
            } else{
                currentCity = $('select[name="select_city"]').val();
            }
            console.log(currentCity);

            const $mapEL = $("#map");
            let lat = $mapEL.attr("data-lat"),
                lng = $mapEL.attr("data-lng"),
                isAddressMap = $mapEL.hasClass("address-map");
            let autocompleteInstance;

            myLatlng = new google.maps.LatLng(lat, lng);

            let setZoom = parseInt($mapEL.attr("data-zoom"));

            let styles = [
                {
                    featureType: "landscape",
                    elementType: "geometry",
                    stylers: [{ saturation: "-100" }],
                },
                {
                    featureType: "poi",
                    elementType: "labels",
                    stylers: [{ visibility: "off" }],
                },
                {
                    featureType: "poi",
                    elementType: "labels.text.stroke",
                    stylers: [{ visibility: "off" }],
                },
                {
                    featureType: "road",
                    elementType: "labels.text",
                    stylers: [{ color: "#545454" }],
                },
                {
                    featureType: "road",
                    elementType: "labels.text.stroke",
                    stylers: [{ visibility: "off" }],
                },
                {
                    featureType: "road.highway",
                    elementType: "geometry.fill",
                    stylers: [
                        { saturation: "-87" },
                        { lightness: "-40" },
                        { color: "#ffffff" },
                    ],
                },
                {
                    featureType: "road.highway",
                    elementType: "geometry.stroke",
                    stylers: [{ visibility: "off" }],
                },
                {
                    featureType: "road.highway.controlled_access",
                    elementType: "geometry.fill",
                    stylers: [
                        { color: "#f0f0f0" },
                        { saturation: "-22" },
                        { lightness: "-16" },
                    ],
                },
                {
                    featureType: "road.highway.controlled_access",
                    elementType: "geometry.stroke",
                    stylers: [{ visibility: "off" }],
                },
                {
                    featureType: "road.highway.controlled_access",
                    elementType: "labels.icon",
                    stylers: [{ visibility: "on" }],
                },
                {
                    featureType: "road.arterial",
                    elementType: "geometry.stroke",
                    stylers: [{ visibility: "off" }],
                },
                {
                    featureType: "road.local",
                    elementType: "geometry.stroke",
                    stylers: [{ visibility: "off" }],
                },
                {
                    featureType: "water",
                    elementType: "geometry.fill",
                    stylers: [
                        { saturation: "-52" },
                        { hue: "#00e4ff" },
                        { lightness: "-16" },
                    ],
                },
            ];

            let styledMap = new google.maps.StyledMapType(styles, {
                name: "Styled Map",
            });

            let mapOptions = {
                zoom: setZoom,
                center: myLatlng,
                mapTypeControlOptions: {
                    mapTypeIds: [google.maps.MapTypeId.ROADMAP, "map_style"],
                },
               // fullscreenControl: false,
               // mapTypeControl: false,
               // streetViewControl: false,
                zoomControl: true,
            };

            function initAutocomplete() {
                let southWestLatLng = new google.maps.LatLng({
                        lat: 49.7656834,
                        lng: 23.8685913,
                    }),
                    northEastLatLng = new google.maps.LatLng({
                        lat: 49.906071,
                        lng: 24.166724,
                    }),
                    cityAutocompleteBounds = new google.maps.LatLngBounds(
                        southWestLatLng,
                        northEastLatLng
                    );

                console.log(currentCity);
                if (currentCity != "") {
                    (southWestLatLng = new google.maps.LatLng(
                        searchBounds[currentCity].bounds[0]
                    )),
                        (northEastLatLng = new google.maps.LatLng(
                            searchBounds[currentCity].bounds[1]
                        )),
                        (cityAutocompleteBounds = new google.maps.LatLngBounds(
                            southWestLatLng,
                            northEastLatLng
                        ));
                }
                // google Autocomplete options
                console.log(southWestLatLng);
                console.log(northEastLatLng);
                let options = {
                    types: ["geocode"],
                    componentRestrictions: { country: "ua" },
                    bounds: cityAutocompleteBounds,
                    strictBounds: true,
                };

                if ($("#streetAutocomplete").length) {
                    if (autocompleteInstance) {
                        google.maps.event.clearInstanceListeners(
                            autocompleteInstance
                        );
                    }
                    autocompleteInstance = new google.maps.places.Autocomplete(
                        document.getElementById("streetAutocomplete"),
                        options
                    );

                    google.maps.event.addListener(
                        autocompleteInstance,
                        "place_changed",
                        function () {
                            let place = autocompleteInstance.getPlace();

                            // Get the street name from the place object
                            let streetName = "";
                            for (
                                let i = 0;
                                i < place.address_components.length;
                                i++
                            ) {
                                let addressType =
                                    place.address_components[i].types[0];
                                if (addressType === "route") {
                                    streetName =
                                        place.address_components[i]["long_name"];
                                    break;
                                }
                            }

                            // Set the street name to the autocomplete input
                            document.getElementById("streetAutocomplete").value = streetName;
                            $("#houseNumber").val("");
                            for (let i = 0; i < markers.length; i++) {
                                // Remove old marker
                                markers[i].setMap(null);
                            }
                        }
                    );
                }
            }
          //  initAutocomplete();

            // delivery page autocomlete
            // if ($('#deliveryStreet').length) {
            //     let deliveryStreet = new google.maps.places.Autocomplete(
            //         (document.getElementById('deliveryStreet')),
            //         options
            //     );

            //     google.maps.event.addListener(deliveryStreet, 'place_changed', function() {
            //         let place = deliveryStreet.getPlace(),
            //             newLocation;

            //         if (!place.geometry.location) return false;

            //         if (markers.length) {
            //             for (let i = 0; i < markers.length; i++) {
            //                 markers[i].setMap(null);
            //             }
            //             map.panTo(myLatlng);
            //         }

            //         newLocation = new google.maps.LatLng(place.geometry.location.lat(), place.geometry.location.lng());
            //         smoothZoomMap(map, 15);
            //         addMarker(newLocation);

            //     });
            // }

            //Create map
            map = new google.maps.Map(document.getElementById("map"), mapOptions);
            map.mapTypes.set("map_style", styledMap);
            map.setMapTypeId("map_style");

            //Set map polygons, set polygons without contact page
            let contactPageMap = $(".contact-page").length;
            if (!contactPageMap) {
                for (let key in polygons) {
                    polygons[key].forEach(function (polygon) {
                        polygon.setMap(map);
                    });
                }
            }

            if (!contactPageMap) {
                $(".marker").each(function (i, el) {
                    addStaticMarker(
                        new google.maps.LatLng(
                            $(this).attr("data-lat"),
                            $(this).attr("data-lng")
                        ),
                        map,
                        $(this).attr("data-string"),
                        $(this).attr("data-image"),
                        $(this).attr("data-delivery")
                    );
                });
            } else {
                $(".marker").each(function (i, el) {
                    if ($(window).width() < 768) {
                        addStaticMarker(
                            new google.maps.LatLng(
                                $(this).attr("data-lat"),
                                $(this).attr("data-lng")
                            ),
                            map,
                            $(this).attr("data-string"),
                            $(this).attr("data-image-mobile"),
                            $(this).attr("data-delivery")
                        );
                    } else {
                        addStaticMarker(
                            new google.maps.LatLng(
                                $(this).attr("data-lat"),
                                $(this).attr("data-lng")
                            ),
                            map,
                            $(this).attr("data-string"),
                            $(this).attr("data-image"),
                            $(this).attr("data-delivery")
                        );
                    }
                });
            }

            //close info box
            map.addListener("click", function () {
                ib.close();
            });

            //Change city
            $("select.city_select[name='city']").on("change", function () {
                streets = []; // remove old steets
                var newCity = $(this).val();
                if (newCity == "") {
                    newCity = "Львів";
                }
                // currentCity = newCity;
                // autocompleteInstance?.unbindAll();
                // initAutocomplete();

                $("#streetAutocomplete").val("");
                // $("#houseNumber").val("");

                let current_city = $('select[name="select_city_user"]').find('option:selected').attr('data-city');

                if (newCity !== current_city) {
                    $('select[name="select_city_user"]')[0].slim.setSelected('');
                    $("#streetAutocomplete").val("");
                    $("#houseNumber").val("");
                }
            });

            // clear address fields and marker inside cabinet address form
            $(document).on("click", ".js-clear-address-fields", function () {
                $('input[name="type_address"]').val("");
                $('input[name="street"]').val("");
                $('input[name="number-building"]').val("");
                $('input[name="number-apartment"]').val("");

                for (let i = 0; i < markers.length; i++) {
                    // Remove old marker
                    markers[i].setMap(null);
                }
            });

            //clear inputs
            var selectCityCheck = false;
            $("#streetAutocomplete").focus(function () {
                selectCityCheck = false;
                $("#streetAutocomplete").val("");
                $("#houseNumber").val("");



                // if($('select[name="select_city_user"]').length){
                //     $('#checkout-form .ss-deselect').trigger('click');
                // }
            });

            // if($('select[name="select_city"]').length){
            //     $(document).on("change", 'select[name="select_city"]', function () {
            //         let city_user = $(this).find('option:selected').attr('data-city');
            //         console.log();
            //         if (currentCity !== city_user) {
            //             $("select.city_select[name='select_city']")[0].slim.setSelected(city_user);
            //         } else {
            //             if ($('#streetAutocomplete').val() && $('#houseNumber').val()) {
            //                 _functions.startSteps();
            //             }
            //         }

            //         if ($('#streetAutocomplete').val() && $('#houseNumber').val()) {
            //             _functions.startSteps();
            //         }
            //     });
            // }

            $("#streetAutocomplete").blur(function () {
                $("#streetAutocomplete").val("");
                if (selectCityCheck === false) {
                    $("#houseNumber").val("");
                }
            });

            //get coordinates
            /*    map.addListener('rightclick', function(e){
                  let lat = e.latLng.lat();
                  let lng = e.latLng.lng();
                  console.log(e.latLng.lat(), e.latLng.lng());
                });*/
        }

        //Step 3
        function checkDeliveryZone(
            newLocation,
            currentPrice,
            redZonePrice,
            yellowZonePrice,
            greenZonePrice
        ) {
            if (polygons.redZonesPolygons) {
                const some = polygons.redZonesPolygons.some(function (polygon) {
                    if (google.maps.geometry.poly.containsLocation(newLocation,polygon) === true) {
                        $('input[name="organizationID"]').val(polygon.organizationID);
                        $("#map").attr("data-current-zone",$("#map").data("red-zone"));
                        $("#map").attr("data-current-zone-type", "red");
                        $("#map").attr("data-current-nomin-delivery-price", 0);
                        $(".deliveryWarning .errorMsg.lowOrder b").html($("#map").data("red-zone-nomin-delivery-price"));
                        $(".deliveryWarning .errorMsg.lowOrderDelivery b, .cost-lines-informer .min-delivery b, .cost-lines .total-line .total-cost").html($("#map").data("red-zone"));
                        $("#map").attr("data-current-delivery-price",$("#map").data("delivery-red-price"));
                        $("#map").attr("data-current-nomin-delivery-price",$("#map").data("red-zone-nomin-delivery-price"));

                        if ($(".card-total-price").length && currentPrice >= redZonePrice) {
                            step3 = true;
                            step3Func(step3);
                        } else {
                            step3 = false;
                            step3Func(step3);
                        }
                        return true;
                    }
                });

                if (some) {
                    console.log("IN RED ZONE");
                    return false;
                }
            }

            if (polygons.yellowZonesPolygons) {
                const some = polygons.yellowZonesPolygons.some(function (polygon) {
                    if (google.maps.geometry.poly.containsLocation(newLocation,polygon) === true) {
                        $('input[name="organizationID"]').val(polygon.organizationID);
                        $("#map").attr("data-current-zone",$("#map").data("yellow-zone"));
                        $("#map").attr("data-current-zone-type", "yellow");
                        $("#map").attr("data-current-nomin-delivery-price", 0);
                        $(".deliveryWarning .errorMsg.lowOrder b").html($("#map").data("yellow-zone-nomin-delivery-price"));
                        $(".deliveryWarning .errorMsg.lowOrderDelivery b, .cost-lines-informer .min-delivery b, .cost-lines .total-line .total-cost").html($("#map").data("yellow-zone"));
                        $("#map").attr("data-current-delivery-price",$("#map").data("delivery-yellow-price"));
                        $("#map").attr("data-current-nomin-delivery-price",$("#map").data("yellow-zone-nomin-delivery-price"));

                        // console.log(currentPrice);
                        // console.log(yellowZonePrice);
                        if ($(".card-total-price").length && currentPrice >= yellowZonePrice) {
                            step3 = true;
                            step3Func(step3);
                        } else {
                            step3 = false;
                            step3Func(step3);
                        }
                        return true;
                    }
                });

                if (some) {
                    console.log("IN YELLOW ZONE");
                    return false;
                }
            }

            if (polygons.greenZonesPolygons) {
                const some = polygons.greenZonesPolygons.some(function (polygon) {
                    if (google.maps.geometry.poly.containsLocation(newLocation,polygon) === true) {
                        $('input[name="organizationID"]').val(polygon.organizationID);
                        $("#map").attr("data-current-zone",$("#map").data("green-zone"));
                        $("#map").attr("data-current-zone-type", "green");
                        $("#map").attr("data-current-nomin-delivery-price", 0);
                        $(".deliveryWarning .errorMsg.lowOrder b").html($("#map").data("green-zone-nomin-delivery-price"));
                        $(".deliveryWarning .errorMsg.lowOrderDelivery b, .cost-lines-informer .min-delivery b, .cost-lines .total-line .total-cost").html($("#map").data("green-zone"));
                        $("#map").attr("data-current-delivery-price",$("#map").data("delivery-green-price"));
                        $("#map").attr("data-current-nomin-delivery-price",$("#map").data("green-zone-nomin-delivery-price"));
                        // console.log($('.card-total-price').length);
                        // console.log(currentPrice);
                        // console.log(greenZonePrice);
                        if ($(".card-total-price").length && currentPrice >= greenZonePrice) {
                            step3 = true;
                            step3Func(step3);
                        } else {
                            step3 = false;
                            step3Func(step3);
                        }
                        return true;
                    }
                });

                if (some) {
                    // console.log("IN GREEN ZONE");
                    return false;
                }
            }

            // No delivery area
            console.log("OUTSIDE of ZONE");
            $("#map").attr("data-current-nomin-delivery-price", 0);
            $("#map").attr("data-current-zone-type", "outside");
            $('.checkout-map-errors,.outsideOfZones').slideDown(300);
            step2 = false;
            step3 = false;

            $(".deliveryWarning .errorMsg.noDelivery b, #not-delivery b, #all-products-delivery").html($("#map").data("outside-zone-nomin-delivery-price"));

            $(".order-button, .main-order-button").addClass("disabled");
            $(".deliveryWarning .errorMsg.empty-address").slideUp(350);
            $(".deliveryWarning .errorMsg.empty-house").slideUp(350);
            $(".deliveryWarning .errorMsg.lowOrder").slideUp(350);
            $(".deliveryWarning .errorMsg.lowOrderDelivery").slideUp(350);
            $(".deliveryWarning .errorMsg.noDelivery").slideDown(350);

            $(".checkout-map #not-delivery").slideDown(350);
            $(".checkout-map #self-delivery").slideUp(350);
            $(".price-wrapp .price-delivery").slideDown(350);
            $(".deliveryWarning .errorMsg.outsideOfZones").slideDown(350);
            $(".save-address").addClass("disabled");
        }

        //Step 2
        function address(latlng) {
            let newLocation = latlng,
                currentPrice = +$(".js-checkout-total").text(),
                redZonePrice = +$("#map").data("red-zone"),
                yellowZonePrice = +$("#map").data("yellow-zone"),
                greenZonePrice = +$("#map").data("green-zone");
            var discount_price = parseFloat(
                $(".price-wrapp__item_discount span").text()
            );
            if (discount_price != 0) {
                currentPrice = currentPrice - discount_price;
            }
            // console.log(currentPrice);
            // console.log(redZonePrice);
            // console.log(yellowZonePrice);
            // console.log(greenZonePrice);
            // console.log(step1);
            // console.log(step2);
            // Start step 3
            if (step1 && step2) {
                for (let i = 0; i < markers.length; i++) {
                    // Remove old marker
                    markers[i].setMap(null);
                }
                smoothZoomMap(map, 15);
                addMarker(newLocation);
                checkDeliveryZone(
                    newLocation,
                    currentPrice,
                    redZonePrice,
                    yellowZonePrice,
                    greenZonePrice
                );
            }
        }

        //Step 1
        GeoLocation.googleMapCoordinates = function () {
            // if ($('#selfDelivery').is(':checked')) {
            //     return;
            // }

            var select_city = $("select.city_select").val();

            console.log(select_city);

            if (select_city == "") {
                select_city = "Львів";

            }
            // console.log(select_city);

            let streetAddress =
                select_city +
                " " +
                $("#streetAutocomplete").val() +
                " вул. " +
                $("#houseNumber").val();

            // console.log("streetAddress ", streetAddress);
            // uncomment
            let geocoder = new google.maps.Geocoder();

            geocoder.geocode(
                {
                    address: streetAddress,
                },
                function (results, status) {
                    if (status == google.maps.GeocoderStatus.OK) {
                        let latlng = new google.maps.LatLng(
                            results[0].geometry.location.lat(),
                            results[0].geometry.location.lng()
                        );
                        $(".deliveryWarning .errorMsg.noData").slideUp(350);
                        $("#pay2 input")
                            .closest(".radiobox-item")
                            .find("span")
                            .css({
                                opacity: "1",
                            });
                        $("#pay2 input").attr("disabled", false);

                        step2 = true;
                        step2Func(step2);
                        address(latlng);
                    } else {
                        step2 = false;
                        step2Func(step2);
                    }
                }
            );
        };

        //Step 1 function
        function step1Func(stepBoolean) {
            if (stepBoolean) {
                $("#streetAutocomplete, #houseNumber").removeClass("invalid");
                $(".deliveryWarning .errorMsg.empty-address").slideUp(350);
            } else {
                $("#streetAutocomplete, #houseNumber").addClass("invalid");
                $(".deliveryWarning .errorMsg.empty-house").slideUp(350);
                $(".deliveryWarning .errorMsg.lowOrder").slideUp(350);
                $(".deliveryWarning .errorMsg.lowOrderDelivery").slideUp(350);
                $(".deliveryWarning .errorMsg.noDelivery").slideUp(350);
                $(".deliveryWarning .errorMsg.empty-address").slideDown(350);
                $(".checkout-map #not-delivery").slideUp(350);
                $(".price-wrapp .price-delivery").slideUp(350);
                $(".checkout-map #self-delivery").slideUp(350);
                resetMap();
            }
        }

        //Step 2 function
        function step2Func(stepBoolean) {
            if (stepBoolean) {
                $("#mapStreet").removeClass("invalid");
                $(".deliveryWarning .errorMsg.empty-house").slideUp(350);
                $(".main-order-button").removeClass("disabled");
                $(".save-address").removeClass("disabled");
                $(".deliveryWarning .errorMsg.outsideOfZones").slideUp(350);
                $(".checkout-map #self-delivery").slideUp(350);
                smoothZoomMap(map, 14);
            } else {
                $("#mapStreet").addClass("invalid");
                $(".deliveryWarning .errorMsg.empty-address").slideUp(350);
                $(".deliveryWarning .errorMsg.lowOrder").slideUp(350);
                $(".deliveryWarning .errorMsg.lowOrderDelivery").slideUp(350);
                $(".deliveryWarning .errorMsg.noDelivery").slideUp(350);
                $(".deliveryWarning .errorMsg.empty-house").slideDown(350);
                $(".main-order-button").addClass("disabled");
                $(".checkout-map #not-delivery").slideUp(350);
                $(".price-wrapp .price-delivery").slideUp(350);
                $(".checkout-map #self-delivery").slideUp(350);
                $(".save-address").addClass("disabled");
            }
        }

        //Step 3 function
        function step3Func(stepBoolean) {
            $('.checkout-map-errors,.outsideOfZones').slideUp(300);
            if (stepBoolean) {
                // smoothZoomMap(map, 15);
                var discount = parseFloat($(".price-wrapp__item_discount span").text());
                // console.log("s1");
                if (+$(".js-checkout-total").text()-parseFloat(discount) < +$("#map").attr("data-current-nomin-delivery-price")) {
                    // console.log("s2");
                    $(".main-order-button").removeClass("disabled");
                    $(".price-wrapp__item_delivery").slideDown(350);
                    $(".deliveryWarning .lowOrder").slideUp(350);
                    $(".deliveryWarning .errorMsg, .deliveryWarning .lowOrderDelivery").slideDown(350);
                    $(".price-wrapp__item_delivery span").text($("#map").attr("data-current-delivery-price"));
                    $(".deliveryWarning .lowOrderDelivery .js-zone-min-price").text($("#map").attr("data-current-nomin-delivery-price"));
                    $(".price-wrapp .price-delivery").slideDown(350);
                    $(".price-wrapp__item_subtotal").slideDown(350);

                    if ($(".price-wrapp__item_delivery").is(":visible")) {
                        var delivery = parseFloat(
                            $(".price-wrapp__item_delivery span").text()
                        );

                        $(".card-total-price").html(
                            +$(".price-wrapp__item_subtotal span").text() +
                            (delivery ? delivery : 0) +
                            -(discount ? discount : 0)
                        );
                    }
                } else {
                    console.log("s3");
                    var discount_price = parseFloat($(".price-wrapp__item_discount span").text());
                    if (discount_price != 0) {
                        $(".price-wrapp__item_subtotal").slideDown(350);
                    } else {
                        $(".price-wrapp__item_subtotal").slideUp(350);
                    }

                    $(".main-order-button").removeClass("disabled");
                    $(".price-wrapp__item_delivery").slideUp(350);
                    $(".deliveryWarning .lowOrder").slideUp(350);
                    $(".deliveryWarning .errorMsg, .deliveryWarning .lowOrderDelivery").slideUp(350);
                    $(".price-wrapp__item_delivery span").text("0");
                    $(".deliveryWarning .lowOrderDelivery .js-zone-min-price").text("0");
                    $(".price-wrapp .price-delivery").slideUp(350);
                    // $('.deliveryWarning .errorMsg.empty-address').slideUp(350);
                    // $('.deliveryWarning .errorMsg.empty-house').slideUp(350);
                    // $('.deliveryWarning .errorMsg.noDelivery').slideUp(350);
                    // $('.deliveryWarning .errorMsg.lowOrder').slideUp(350);
                    // $('.deliveryWarning .errorMsg.lowOrderDelivery').slideUp(350);
                    // $('.checkout-map #not-delivery').slideUp(350);
                    // $('.price-wrapp .price-delivery').slideUp(350);
                    // $('.checkout-map #self-delivery').slideUp(350);
                    // $('.save-address').addClass('disabled');
                }
            } else {
                console.log("s4");
                $("#mapStreet").addClass("invalid");
                $(".main-order-button").addClass("disabled");
                $(".price-wrapp__item_subtotal").slideUp(350);
                $(".deliveryWarning .lowOrderDelivery").slideUp(350);
                $(".price-wrapp__item_delivery").slideDown(350);
                $(".price-wrapp__item_delivery span").text($("#map").attr("data-current-delivery-price"));
                $(".deliveryWarning .errorMsg,.deliveryWarning .lowOrder,.deliveryWarning .lowOrderDelivery").slideDown(350);
                $(".deliveryWarning .lowOrder .js-zone-min-price").text($("#map").attr("data-current-zone"));
                $(".deliveryWarning .lowOrderDelivery .js-zone-min-price").text($("#map").attr("data-current-nomin-delivery-price"));
                var discount_price = parseFloat(
                    $(".price-wrapp__item_discount span").text()
                );
                if (discount_price != 0) {
                    $(".price-wrapp__item_subtotal").slideDown(350);
                } else {
                    $(".price-wrapp__item_subtotal").slideUp(350);
                }

                if (
                    $(".price-wrapp__item_delivery").is(":visible") ||
                    $(".price-wrapp__item_discount").is(":visible")
                ) {
                    var delivery = parseFloat(
                        $(".price-wrapp__item_delivery span").text()
                    );
                    var discount = parseFloat(
                        $(".price-wrapp__item_discount span").text()
                    );
                    $(".card-total-price").html(
                        +$(".price-wrapp__item_subtotal span").text() +
                        (delivery ? delivery : 0) +
                        -(discount ? discount : 0)
                    );
                }
                // smoothZoomMap(map, 11);
            }
        }

        //Reset markers and map zoom
        function resetMap() {
            if (markers.length) {
                for (let i = 0; i < markers.length; i++) {
                    markers[i].setMap(null);
                }
                map.panTo(myLatlng);
                smoothZoomMap(map, 10);
            }
        }

        //Smooth map zoom
        function smoothZoomMap(map, targetZoom) {
            let currentZoom = arguments[2] || map.getZoom();
            if (currentZoom != targetZoom) {
                google.maps.event.addListenerOnce(
                    map,
                    "zoom_changed",
                    function (event) {
                        smoothZoomMap(
                            map,
                            targetZoom,
                            currentZoom + (targetZoom > currentZoom ? 1 : -1)
                        );
                    }
                );
                setTimeout(function () {
                    map.setZoom(currentZoom);
                }, 100);
            }
        }

        //Start steps
      /*  _functions.startSteps = function () {
            if ($("#streetAutocomplete").val() && $("#houseNumber").val()) {
                if ($("#streetAutocomplete").val()) {
                    $("#streetAutocomplete").removeClass("invalid");
                }
                if ($("#houseNumber").val()) {
                    $("#houseNumber").removeClass("invalid");
                }
                step1 = true;
                step2 = true; //remove
                // console.log("startSteps1");
                GeoLocation.googleMapCoordinates(); // step 1
            } else {
                step1 = false;
            }
        };
*/
        function debounce(func, wait, immediate) {
            var timeout;
            return function () {
                var context = this,
                    args = arguments;
                var later = function () {
                    timeout = null;
                    if (!immediate) func.apply(context, args);
                };
                var callNow = immediate && !timeout;
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
                if (callNow) func.apply(context, args);
            };
        }

        //START steps
        $("#streetAutocomplete").change(function () {
            _functions.startSteps();
            if($('select[name="select_city_user"]').length){
                $('select[name="select_city_user"]')[0].slim.setSelected('');
            }
        });

        $("#houseNumber").keyup(
            debounce(function () {
                if ($("#streetAutocomplete").val().trim() !== "") {
                    _functions.startSteps();
                }
            }, 200)
        );

        $("#houseNumber").on("blur", function () {
            if ($(this).val().trim() === "") {
                $(".main-order-button").addClass("disabled");
            }
        });

        $("#streetAutocomplete, #houseNumber").focus(function (e) {
            if (e.which != 13 && $("#houseNumber").length) return false;
            _functions.startSteps();
        });

        //Mobile button search
        $("#StartSearch").on("click", function () {
            if ($("#streetAutocomplete").val() && $("#houseNumber").val()) {
                if ($("#streetAutocomplete").val()) {
                    $("#streetAutocomplete").removeClass("invalid");
                }
                if ($("#houseNumber").val()) {
                    $("#houseNumber").removeClass("invalid");
                }
                step1 = true;
                step1Func(step1);
                GeoLocation.googleMapCoordinates(); // step 1
            } else {
                step1 = false;
                step1Func(step1);
            }
        });

        //change price after click button
        // $('.checkout-products .thumb-input-number button').on('click', function() {
        //     $('.main-order-button').addClass('disabled');
        //     if ($('#streetAutocomplete').val() && $('#houseNumber').val()) {
        //         setTimeout(function () {
        //             _functions.startSteps();
        //             $('.main-order-button').removeClass('disabled');
        //         }, 500);
        //     }
        // });

        //change price after remove product
        $(".checkout-products .btn-close").on("click", function () {
            if ($("#streetAutocomplete").val() && $("#houseNumber").val()) {
                _functions.startSteps();
            }
        });

        //selfDelivery
        $("#selfDelivery").on("click", function (e) {
            $(".main-order-button").removeClass("disabled");
            $(".deliveryWarning .errorMsg.noDelivery").slideUp(350);
            $(".checkout-map #not-delivery").slideUp(350);
            $(".price-wrapp .price-delivery").slideUp(350);
            $(".deliveryWarning .errorMsg.lowOrderDelivery").slideUp(350);
            $(".deliveryWarning .errorMsg.lowOrder").slideUp(350);
            $(".price-wrapp .price-discount").slideDown();

            $("#streetAutocomplete").val("");
            $("#houseNumber").val("");

            resetMap();
        });

        //change location
        $("#location_delivery").on("change", function () {
            let newDelivery = $(this).val();
            for (let i = 0; i < staticMarkers.length; i++) {
                if (staticMarkers[i].selfdelivery == newDelivery) {
                    map.setZoom(14);
                    map.setCenter(staticMarkers[i].getPosition());
                }
            }
            $(".checkout-map #self-delivery").find("span").text(newDelivery);
            $(".checkout-map #self-delivery").slideDown(350);
        });

        //driveDelivery
        $("#driveDelivery").on("click", function () {
            if ($("#streetAutocomplete").val() && $("#houseNumber").val()) {
                _functions.startSteps();
            }
            $(".price-wrapp .price-discount").slideUp();
            $(".checkout-map #self-delivery").slideUp(350);
            $(".main-order-button").addClass("disabled");

            resetMap();

            //reload sumoselect
            $("#select_time")[0].sumo.unload();
            $("#select_time").find("option:first-child").prop("disabled", true);
            $("#select_time").find("option:first-child").prop("selected", true);
            $("#select_time")
                .find(".options opt:first-child")
                .prop("disabled", true);
            $("#select_time").SumoSelect({
                floatWidth: 0,
                nativeOnDevice: [],
            });
        });

        //cabinet edit address
        $(document).on("click", ".js-edit-address", function (e) {
            let $this = $(this),
                $adressItem = $this.closest(".js-address-item"),
                name_address = $adressItem.find(".js-address-name").text(),
                street = $adressItem.find(".js-street").text(),
                number_building = $adressItem.find(".js-house").text(),
                number_apartment = $adressItem.find(".js-apartment").text(),
                index_edit = $adressItem.index();

            $('input[name="type_address"]').val(name_address);
            $('input[name="street"]').val(street);
            $('input[name="number-building"]').val(number_building);
            $('input[name="number-apartment"]').val(number_apartment);

            $("#houseNumber").trigger("change");
        });

        //Load map
        if ($("#map").length || $('#save-user-address').length) {
            setTimeout(function () {
                initLocationsMap();
                if ($("#houseNumber").length && $("#streetAutocomplete").length) {
                    if (
                        $("#houseNumber").val().trim() !== "" &&
                        $("#streetAutocomplete").val().trim() !== ""
                    ) {
                        $("#houseNumber").trigger("keyup");
                    }
                }
            }, 500);
        }
    });

</script>

<!--

червона зона id=2
 { "lng": 23.9857574, "lat": 49.8532966 },
 { "lng": 23.983128, "lat": 49.8498421 },
 { "lng": 23.982548, "lat": 49.8492745 },
{ "lng": 23.983127, "lat": 49.8468737 },



 { "lng": 23.9840065, "lat": 49.8445144 },
 { "lng": 23.9932374, "lat": 49.8423903 },
  { "lng": 23.9952544, "lat": 49.8404945 },
  { "lng": 23.9941514, "lat": 49.8455918 },
   { "lng": 23.9945074, "lat": 49.8484199 },
    { "lng": 23.9958658, "lat": 49.8493355 },
    { "lng": 23.9989838, "lat": 49.8491166 },



червона зона id=3
{ "lng": 23.982548, "lat": 49.8492745 },
  { "lng": 23.9665605, "lat": 49.8454041 },







 { "lng": 23.9764424, "lat": 49.8396786 }
{ "lng": 23.9806814, "lat": 49.839544 }
  { "lng": 23.9832729, "lat": 49.837982 }

{ "lng": 23.9952544, "lat": 49.8404945 },
{ "lng": 23.9932374, "lat": 49.8423903 },

 { "lng": 23.9840065, "lat": 49.8445144 },
 { "lng": 23.982548, "lat": 49.8492745 }






  зєднуюються зони
{ "lng": 23.9932374, "lat": 49.8423903 },
{ "lng": 23.9840065, "lat": 49.8445144 },
{ "lng": 23.982548, "lat": 49.8492745 }



жовта зона шевченківський рн

єрошенка
{ "lng": 23.9989838, "lat": 49.8491166 },
{ "lng": 23.9958658, "lat": 49.8493355 },
{ "lng": 23.9945074, "lat": 49.8484199 },
{ "lng": 23.9941514, "lat": 49.8455918 },
{ "lng": 23.9952544, "lat": 49.8404945 },
{ "lng": 24.000026, "lat": 49.8375262 },
{ "lng": 24.0029442, "lat": 49.8371387 },
{ "lng": 24.0048976, "lat": 49.8357338 },
{ "lng": 24.0112195, "lat": 49.8443812 },
-->


<!--

жовта зона 5
{ "lng": 23.9850056, "lat": 49.8348136 },
{ "lng": 24.0002148, "lat": 49.8375711 },


{ "lng": 23.9952544, "lat": 49.8404945 },
{ "lng": 23.9832729, "lat": 49.837982 },

{ "lng": 23.9806814, "lat": 49.839544 },
{ "lng": 23.9764424, "lat": 49.8396786 },

-->

<!--{ "lng": 24.014481, "lat": 49.845388 },-->
</body>
</html>
